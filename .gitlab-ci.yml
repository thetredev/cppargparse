variables:
  CPPARGPARSE_ARTIFACT_NAME: "${CI_PROJECT_NAME}-${CI_COMMIT_SHORT_SHA}"


stages:
  - test


test:
  stage: test
  image: registry.gitlab.com/treichl/cppargparse:latest
  tags:
    - gitlab-org
  script:
    # configure build directory
    - mkdir build
    - cd build
    # configure coverage target
    - cmake -G"Ninja" -DCMAKE_BUILD_TYPE=Profiling ..
    # run coverage target
    - ninja coverage
    # build doxygen documentation
    - cd ..
    - doxygen
  artifacts:
    name: ${CPPARGPARSE_ARTIFACT_NAME}
    paths:
      - include/
      - docs/
    expire_in: 1000 yrs
